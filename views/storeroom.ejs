<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles/navbar.css">
    <link rel="stylesheet" href="/styles/storeroom.css">
    <title>Document</title>
</head>
<!-- 增加上边距防止被导航盖住 -->
<body style="margin-top: 50px;" data-player-id="<%= playerId %>">
    <%- include('../public/partials/navbar') %>
    <div class="storeroom_box">
        <div class="left_games_list">
            <% if (loggedIn) { %>
              <% games.forEach((game, index) => { %>
                <div class="game_item" onclick="selectGame(<%= JSON.stringify(game) %>)" <% if (index === 0) { %>id="selected_game"<% } %>>
                    <div class="lr">
                    <img src="<%= game.game_photo %>" alt="logo" style="height: 20px;">
                    <span class="text-ellipsis"><%= game.game_name %></span>
                </div>
                <div style="width: 100%;color: #0b0606;height: 2px;"></div>
                </div>
              <% }); %>
            <% } else { %>
              登录后显示内容
            <% } %>
          </div>
        <div class="right_game_info">
            <div class="top_big_photo">
                <img class="scaled-image" src="" alt="">
            </div>

            <div class="the_game_content">
                <div class="button_content transparent-bg">
                  <button style="height: 40px;width: 160px;" onclick="openNewPage()">开始游戏</button>
                  <div>游戏时长:0分钟</div>
                </div>
                <div class="game_info transparent-bg" style="font-size: larger;">

                </div>
                
            </div>
        </div>
    </div>
    <script>
 let selectedGame = <%- games.length > 0 ? JSON.stringify(games[0]) : 'null' %>;
 console.log(selectedGame);
  function selectGame(game) {
    selectedGame = game;
    document.getElementById('selected_game').removeAttribute('id');
    event.target.setAttribute('id', 'selected_game');
    updateGameInfo();
  }

  function updateGameInfo() {
    document.querySelector('.top_big_photo img').src = selectedGame.game_photo;
    document.querySelector('.game_info').textContent = selectedGame.game_about;
    // 更新背景图片
    document.querySelector('.the_game_content').style.backgroundImage = `url('${selectedGame.game_photo}')`;
  }

  updateGameInfo(); // 初始化时更新游戏信息

  // 运行游戏
  function openNewPage() {
  // 打开一个新窗口
  const newWindow = window.open('', '_blank');
  // 将新窗口的文档类型设置为HTML
  newWindow.document.write('<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body></body></html>');

  // 使用fetch从同级目录加载a.js
  fetch('../a.js')
    .then(response => response.text())
    .then(scriptContent => {
      // 创建一个新的script元素
      const scriptElement = newWindow.document.createElement('script');
      scriptElement.innerHTML = scriptContent;
      // 将新的script元素添加到新窗口的body中
      newWindow.document.body.appendChild(scriptElement);
    })
    .catch(error => {
      console.error('Error fetching a.js:', error);
    });
}

</script>
</body>
</html>